{
    "image": "mcr.microsoft.com/devcontainers/base:noble",
    "features": {
        "ghcr.io/devcontainers/features/git:1": {},
        "ghcr.io/devcontainers/features/git-lfs:1": {},
        "ghcr.io/devcontainers/features/rust:1.4.0": {},
        "ghcr.io/devcontainers-community/features/llvm": {
            "version": "20"
        },
        "ghcr.io/devcontainers/features/python:1": {
            "version": "3"
        },
        "./s-core-local": {
            "BAZEL_VERSION": "7.5.0",
            "BUILDIFIER_VERSION": "8.2.1",
            // The following sha256sum is for the binary buildifier-linux-amd64
            // from the GitHub release page of buildtools
            // It is generated by running 'sha256sum buildifier-linux-amd64'
            "BUILDIFIER_SHA256": "6ceb7b0ab7cf66fceccc56a027d21d9cc557a7f34af37d2101edb56b92fcfa1a",
            "BAZEL_COMPILE_COMMANDS_VERSION": "0.17.2",
            // The following sha256sums are for the deb package bazel-compile-commands_<version>-<codename>_amd64.deb
            // where <codename> is the Ubuntu codename (e.g., jammy, focal, noble)
            // and <version> is the version of bazel-compile-commands
            // The format is: <codename>:<sha256sum>;<codename>:<sha256sum>;...
            // For example: jammy:6cde78e1a58c8f9047446cce25a81a676b0f293194175c9fe61586224c0b6f84;noble:97239b316df58fd3370a8aa6350790ececd5e4a1de30efb42d45cb1c300a179a;...
            // It is generated by running 'sha256sum bazel-compile-commands_<version>-<codename>_amd64.deb'
            "BAZEL_COMPILE_COMMANDS_SHA256": "jammy:6cde78e1a58c8f9047446cce25a81a676b0f293194175c9fe61586224c0b6f84;noble:97239b316df58fd3370a8aa6350790ececd5e4a1de30efb42d45cb1c300a179a;focal:c861f4f36cc2884eefbd488f19c49a9674ac093210a503bce032eac8b94b3660",
            "DRAWIO_VERSION": "27.0.9",
            // The following sha256sum is for the deb package drawio-amd64-<version>.deb
            // It is generated by running 'sha256sum drawio-amd64-<version>.deb'
            "DRAWIO_SHA256": "3b941454f05f175ff21c983d589f7804229801bd82e1a0e8c1d97af302c2fae0"
        }
    },
    "initializeCommand": "mkdir -p ${localEnv:HOME}/.cache/bazel",
    "customizations": {
        "vscode": {
            "extensions": [
                "mads-hartmann.bash-ide-vscode",
                "bazelbuild.vscode-bazel",
                "dbaeumer.vscode-eslint",
                "EditorConfig.EditorConfig",
                "llvm-vs-code-extensions.vscode-clangd",
                "jebbs.plantuml", //to preview PlantUML diagrams
                "hediet.vscode-drawio", //for drawio integration
                "swyddfa.esbonio" // for Sphinx documentation support
            ],
            "settings": {
                "files.insertFinalNewline": true,
                "editor.formatOnSave": false,
                "[cpp]": {
                    "editor.defaultFormatter": "llvm-vs-code-extensions.vscode-clangd"
                },
                "clangd.path": "/usr/bin/clangd",
                "clangd.arguments": [
                    "--compile-commands-dir=${workspaceFolder}/",
                    "--pretty",
                    "--background-index"
                ],
                "C_Cpp.intelliSenseEngine": "disabled",
                "tasks": {
                    "version": "2.0.0",
                    "tasks": [
                        {
                            "label": "Run bazel-compile-commands",
                            "command": "bazel-compile-commands",
                            "type": "shell",
                            "isBackground": true,
                            "hide": true
                        },
                        {
                            "label": "Update compile_commands.json",
                            "command": "${command:clangd.restart}",
                            "isBackground": true,
                            "dependsOn": [
                                "Run bazel-compile-commands"
                            ],
                            "group": {
                                "kind": "build",
                                "isDefault": true
                            }
                        }
                    ]
                }
            }
        }
    }
}
