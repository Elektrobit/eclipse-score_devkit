{
    "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
    "features": {
        "ghcr.io/devcontainers/features/git:1": {},
        "ghcr.io/devcontainers/features/git-lfs:1": {},
        "ghcr.io/devcontainers/features/rust:1": {},
        "ghcr.io/devcontainers-community/features/llvm": {
            "version": "20"
        },
        "ghcr.io/devcontainers/features/python:1": {
            "version": "3"
        },
        "./s-core-local": {
            "BAZEL_VERSION": "7.5.0",
            "BUILDIFIER_VERSION": "8.2.1",
            "BAZEL_COMPILE_COMMANDS_VERSION": "0.17.2"
        }
    },
    "initializeCommand": "${localEnv:HOME}/./cache/bazel",
	"mounts": [
		"source=${localEnv:HOME}/./cache/bazel,target=/home/developer/./cache/bazel,type=bind,consistency=cached"
	],
    "containerEnv": {
		"USER": "developer"
	},
	"containerUser": "developer",
    "customizations": {
        "vscode": {
            "extensions": [
                "mads-hartmann.bash-ide-vscode",
                "bazelbuild.vscode-bazel",
                "dbaeumer.vscode-eslint",
                "EditorConfig.EditorConfig",
                "llvm-vs-code-extensions.vscode-clangd",
                "jebbs.plantuml", //to preview PlantUML diagrams
                "hediet.vscode-drawio" //for drawio integration
            ],
            "settings": {
				"files.insertFinalNewline": true,
                "editor.formatOnSave": false,
				"[cpp]": {
					"editor.defaultFormatter": "llvm-vs-code-extensions.vscode-clangd"
				},
                "clangd.arguments": [
					"--compile-commands-dir=${workspaceFolder}/",
					"--pretty",
					"--background-index"
				],
				"C_Cpp.intelliSenseEngine": "disabled"
            }
        }
    }
}
